# 爱河里县总代地图系统

## 项目介绍

爱河里县总代地图系统是一个基于Web的地图应用，用于直观展示中国各县是否已有县总代。系统通过颜色区分有无县总代的县区，并提供详细信息查看功能。管理员可以对县总代信息进行修改，普通用户只能查看信息。

## 功能特点

- 基于GeoJSON的中国县级地图展示
- 通过颜色区分有无县总代的县区（有县总代显示绿色，无县总代显示灰色）
- 点击县区可查看详细信息
- 管理员登录系统后可修改县总代信息
- 响应式设计，适配不同设备

## 技术栈

- 后端：Python + Flask
- 前端：HTML + CSS + JavaScript
- 地图：Leaflet.js
- 数据：GeoJSON + Excel
- 安全：JWT认证 + CSRF保护 + CryptoJS加密

## 文档

系统相关文档位于 [docs](./docs) 目录：

- [登录安全流程](./docs/login_security.md)
- [密码安全处理](./docs/password_security.md)
- [API安全机制](./docs/api_security.md)
- [数据安全机制](./docs/data_security.md)
- [部署安全最佳实践](./docs/deployment_security.md)

## 安装与运行

### 环境要求

- Python 3.6+
- pip 包管理工具

### 安装步骤

1. 克隆或下载项目代码

2. 安装依赖包

```bash
pip install -r requirements.txt
```

3. 运行应用

```bash
python app.py
```

4. 在浏览器中访问 http://localhost:5000

## 安全特性

本系统实现了多层次的安全保护机制：

- **密码加密**：使用CryptoJS库实现前端密码加密，采用SHA256哈希和AES加密的组合方式
- **CSRF保护**：所有API请求都需要CSRF令牌验证，防止跨站请求伪造攻击
- **JWT认证**：使用JWT进行用户身份验证，支持令牌过期和签名验证
- **请求限制**：实现登录尝试次数限制，防止暴力破解
- **安全退出**：提供安全的退出机制，清除客户端凭证
- **数据验证**：对用户输入进行严格验证，防止注入攻击

## 使用说明

### 普通用户

- 打开网页即可查看地图
- 绿色区域表示已有县总代，灰色区域表示暂无县总代
- 点击任意县区可查看该县是否有县总代及详细信息

### 管理员

- 使用管理员账号登录（默认用户名：admin，密码：123456）
- 登录后可查看和修改县总代信息
- 点击县区，在右侧面板中编辑县总代信息并保存

## 数据说明

- `中国_县.geojson`：中国县级行政区划GeoJSON数据
- `爱河里数据_地址拆分.xlsx`：县总代信息数据

## 接口说明

### 1. 获取县总代数据

```
GET /api/agents
```

### 2. 获取单个县信息

```
GET /api/county/<county_name>
```

### 3. 更新县总代信息（需管理员权限）

```
PUT /api/county/<county_name>
```

### 4. 管理员登录

```
POST /api/login
```

## 注意事项

- 本系统仅用于演示，实际应用中应加强安全措施
- 默认管理员账号密码应在生产环境中修改
- 数据更新目前仅在内存中进行，实际应用中应实现数据持久化